@page "/user/ChangePassword"

@inject IStringLocalizer<Resource> localizer
@inject IAccountRepository accountReository
@inject NavigationManager navigationManager
@inject ToastService toastService;

@attribute [Authorize]

<AuthorizeView>
    <div class="container-xl mt-5">
        <EditForm class="container-sm mt-4 col-lg-4" Context="ChangePasswordContext" Model=changePassword>
            <DataAnnotationsValidator />
            <div class="card mb-4">
                <div class="card-header"><BitLabel>تغییر رمز عبور</BitLabel></div>
                <div class="card-body">
                    <BitTextField Label="رمز عبور قبلی" Type="BitTextFieldType.Password" Class="dir-ltr" Placeholder="رمز عبور قبلی" @bind-Value="@changePassword.CurrentPassword" IsRequired />
                    <BitTextField Label="رمز عبور جدید" Type="BitTextFieldType.Password" Class="dir-ltr" Placeholder="رمز جدید" @bind-Value="@changePassword.NewPassword" IsRequired />
                    <div class="mb-3 d-grid gap-2">
                        <BaseButtonComponent Caption=@localizer["SaveChanges"]
                                             IsBussyCaption=@localizer["Loading"]
                                             Color=ColorEnum.Primary
                                             Icon=BitIconName.Save
                                             EditContext=ChangePasswordContext
                                             OnClick=SubmitChangePassword></BaseButtonComponent>
                        <BaseNavigateButtonComponent Text="انصراف"
                                                     Icon="BitIconName.Cancel"
                                                     Href="user/info">
                        </BaseNavigateButtonComponent>
                    </div>
                </div>
            </div>
        </EditForm>
    </div>
</AuthorizeView>
@code {
    private ChangePasswordDTO changePassword = new ChangePasswordDTO();

    private async Task SubmitChangePassword()
    {
        if (await accountReository.ChangePassword(changePassword))
        {
            toastService.ShowToast("رمز عبور شما با موفقیت تغییر یافت", ToastLevel.Success);
            navigationManager.NavigateTo("user/info");
        }
    }
}