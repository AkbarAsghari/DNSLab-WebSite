@page "/Page/Edit/{PageId:guid}"
@inject IPageRepository _PageRepository
@inject NavigationManager _navManager
@inject ToastService toastService

@if (existPage == null)
{
    <Loading />
}
else
{
    <PageGeneratorForm page=existPage TagsInput=Tags OnValidSubmit=Update Title="ویرایش صفحه"></PageGeneratorForm>
}

@code {

    [Parameter] public Guid PageId { get; set; }

    private PageDTO existPage;
    private TagsInput Tags = new TagsInput();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            existPage = await _PageRepository.GetPage(PageId);
            Tags.Tags = existPage.Keywords.ToList();
            await this.InvokeAsync(() => StateHasChanged());
        }
    }

    public async Task Update()
    {
        existPage.Keywords = Tags.Tags.ToArray();

        if (await _PageRepository.EditPage(existPage))
        {
            _navManager.NavigateTo("Page/MyPages");
            toastService.ShowToast("PageUpdated", Enums.ToastLevel.Success);
        }
    }
}


