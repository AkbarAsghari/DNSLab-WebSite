@using DNSLab.DTOs.Tips
@using System.Text
@inject ITipRepository _TipRepository

@if (result.Count > 0)
{
    <h6>حمایت کنندگان</h6>
    @foreach (var rows in result.Chunk(10))
    {
        <div class="row">
            @foreach (var item in @rows)
            {
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
                    <CoffeeSupportItem FullName="@item.FullName" Count="@item.Count" />
                </div>
            }
        </div>
    }
}

@code {
    List<TipDTO> result = new List<TipDTO>();

    protected override async Task OnInitializedAsync()
    {
        var Supporters = await _TipRepository.GetTips();

        if (Supporters.Count() > 0)
        {
            StringBuilder sb = new StringBuilder();

            var countUnknownSupportersCoffee = Supporters.Where(x => String.IsNullOrWhiteSpace(x.FullName));

            result.Add(new TipDTO { FullName = $"{countUnknownSupportersCoffee.Count()} فرد ناشناس", Count = countUnknownSupportersCoffee.Sum(x => x.Count) });
            result.AddRange(Supporters.Where(x => !String.IsNullOrWhiteSpace(x.FullName)).Select(x => new TipDTO { FullName = x.FullName, Count = x.Count }));
        }

    }
}

